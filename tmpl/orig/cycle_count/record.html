<!DOCTYPE html>
<html>
<head>
<%include file="../header_inc_v4.html" />
<title>POSX - Cost &amp; Price Tool</title>

<script type="text/javascript">
function load_record(r_id)
{
    g_tg_tg_lst.r_id = r_id;
    
    var els = g_v_ctrl.data('in_els');
    els.user[0].empty().change();
    
    get_js_ex('?fn=load_record', {'r_id': r_id}, function(js) {
        var v_lst = [];
        for(var u in js.r_users) v_lst.push( $('<option></option>').val(u).text(js.r_users[u]) );
        els.user[0].append(v_lst).change();
        
    }, undefined, undefined, undefined, '__load_record__');
}

function load_record_detail_by_user()
{
    g_tg_tg_lst.u_id = parseInt(g_v_ctrl.data('in_els').user[0].val()) || 0;
    if(!g_tg_tg_lst.u_id) {
        g_v_tg_lst.tinygrid('update', 0, true);
        return;
    }
    
    g_v_tg_lst.tinygrid('update', -1, true, true, true);
}

$(function() {

g_v_ctrl = $('.x_ctrl');
idx_elements(g_v_ctrl, 5);
var els = g_v_ctrl.data('in_els');
els.user[0].change(load_record_detail_by_user);

g_tg_tg_lst = {};
g_v_tg_lst = $('#tg_lst').tinygrid({
len:0,
src:{page:'?fn=load_record_detail_by_user', data:g_tg_tg_lst},
cols: [{name:'Num', width:80},
       {name:'Desc', width:"70%"},
       {name:'QtyChg', width:100},
       {name:'Loc', width:120},
       {name:'DateTime', width:210},
       ],
click: function(r, c, d) {
    
}
});

%if r_id:
load_record(${r_id});
%endif

});

</script>

<style type="text/css">
.ui-widget {font-size:18px;}
.x_ctrl input, .x_ctrl select {margin-right:10px;}

#tg_lst {top:0;bottom:0;right:0;left:0}

#dlg_record >div {margin-bottom:8px}
#dlg_record >div:nth-child(1) textarea {width:350px;height:70px;}
#dlg_record >div:nth-child(2) {height:200px;overflow-y:scroll;border:1px solid #ccc;background-color:#f0f0f0;padding:4px;}

</style>

</head>
<body>

<div class="x_ctrl">

<select name="ctrl_user" style="width:200px"></select>

</div>

<div class="x_body">

<div id="tg_lst"></div>


</div>

</body>
</html>


